<div class="header-top">
  <% if user_signed_in? %>
  <%= link_to user_path(current_user), class: "top-link pt-3" do %>マイページ<% end %>
  <% end %>
  <p class="header-icon pl-5" href="/">PORTA</p>
</div>

<div class="header-low">
  <nav class="navbar navbar-expand-lg navbar-light">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <%= link_to 'ポートフォリオ一覧', portfolios_path, class: "nav-item nav-link " %>
        </li>
        <li class="nav-item">
          <%= link_to 'ログアウト', destroy_user_session_path, method: :delete, class: "nav-item nav-link " %>
        </li>
        <li class="nav-item dropdown">
            <a class="nav-link" data-toggle="dropdown" href="#" role="button" >通知</a>
            <div class="dropdown-menu dropdown-menu-notifications">
              <div class="d-flex ml-3">
                <% notifications = @notifications.where.not(visitor_id: current_user.id) %>
                <% if notifications.exists? %>
                    <%= render partial: "portfolios/notification", collection: @notifications %>
                <% else %>
                    <p>通知はありません</p>
                <% end %>
              </div>
              <% @review_to_me = PfReview.where(reviewed_user_id: current_user) %>
            　<% @review_to_me_unreview = @review_to_me.select { |review| review.review_each_other == false } %>
              　<% @review_to_me_unreview.each do |review| %>
              　<div class="d-flex ml-3">
              　 <% user = User.find( review.reviewer_user_id) %>
              　 <div class="notification-user-image"><%= attachment_image_tag user,:profile_image, fallback: "no-user-image.png", size:"50x50", class:"fallback" %></div>
              　 <div class="notification-user-text"> <%= link_to portfolio_path(user.portfolio.id),class: "danger" do %><%= user.name %><% end %>さんからのレビューに返信してください</div>
              　<% end %>
              　</div>
            </div>
        </li>
      </ul>
    </div>
  </nav>
</div>


  <div class="selected-item">
    <a class="selected-title pl-5">ポートフォリオ一覧</a><br />
    <a class="pl-5">アプリ名とタグ名で検索ができます</a>
  </div>

  <div>
    <%= form_tag(portfolios_path, method: :get) do  %>
    <div class="input-group my-2 mx-auto px-5">
      <%= text_field_tag :search, '',  placeholder: "Search Portfolios", class: "form-control form-control" %>
      <%= select_tag :range, options_for_select([["Title"],["Tag"]]) %>
        <span class="input-group-btn">
        <%= submit_tag "検索", class: "btn btn-primary" %>
        </span>
      <% end %>
    </div>
  </div>

  <div>
    <ul class="pf-list d-flex justify-content-center pt-5">
      <% if @renge == "Title" %>
        <% @portfolios.each do |portfolio| %>
          <li><%= link_to portfolio_path(portfolio) do %><%= attachment_image_tag portfolio,:image, fallback: "no-image.jpg", size:"300x225", class:"fallback" %> <% end %><br />
          <b><%= portfolio.title %></b><br />
          <%= portfolio.user.name %><br />
          <%= portfolio.created_at.strftime("%Y年%m月%d日") %></li>
        <% end %>
      <% else %>
        <% @tags.each do |tag| %>
          <% tag.portfolios.each do |portfolio| %>
          <li><%= link_to portfolio_path(portfolio) do %><%= attachment_image_tag portfolio,:image, fallback: "no-image.jpg", size:"300x225", class:"fallback" %> <% end %><br />
          <b><%= portfolio.title %></b><br />
          <%= portfolio.user.name %><br />
          <%= portfolio.created_at.strftime("%Y年%m月%d日") %></li>
          <% end %>
        <% end %>
      <% end %>
    </ul>
  </div>